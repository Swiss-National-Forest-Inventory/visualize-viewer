var H=()=>{let n=document.getElementById("loader"),e=document.getElementById("content");n.classList.remove("hidden"),e.classList.add("hidden")},G=()=>{let n=document.getElementById("loader"),e=document.getElementById("content");n.classList.add("hidden"),e.classList.remove("hidden")},X=(n,e)=>{let t=document.getElementById("loader");t.innerHTML=n.config.error[e]};var R="https://int.visualize.admin.ch",C="https://lindas-cached.cluster.ldbar.ch/query",q=`${C}/https://environment.ld.admin.ch/foen/nfi/nfi_C-96/cube/2024-1`,y=!1,j="https://visualize.admin.ch/create/new?cube=",V="https://environment.ld.admin.ch/foen/nfi/Topic/44",g=["https://environment.ld.admin.ch/foen/nfi/nfi_C-94/cube/2024-1","https://environment.ld.admin.ch/foen/nfi/nfi_C-96/cube/2024-1","https://environment.ld.admin.ch/foen/nfi/nfi_C-20/cube/2024-1","https://environment.ld.admin.ch/foen/nfi/nfi_C-2632/cube/2024-1"],K=["https://environment.ld.admin.ch/foen/nfi/Topic/47","https://environment.ld.admin.ch/foen/nfi/Topic/47r","https://environment.ld.admin.ch/foen/nfi/Topic/48","https://environment.ld.admin.ch/foen/nfi/Topic/48r","https://environment.ld.admin.ch/foen/nfi/Topic/397","https://environment.ld.admin.ch/foen/nfi/Topic/397r","https://environment.ld.admin.ch/foen/nfi/Topic/19","https://environment.ld.admin.ch/foen/nfi/Topic/19r","https://environment.ld.admin.ch/foen/nfi/Topic/70","https://environment.ld.admin.ch/foen/nfi/Topic/70r","https://environment.ld.admin.ch/foen/nfi/Topic/69","https://environment.ld.admin.ch/foen/nfi/Topic/69r","https://environment.ld.admin.ch/foen/nfi/Topic/72","https://environment.ld.admin.ch/foen/nfi/Topic/72r","https://environment.ld.admin.ch/foen/nfi/Topic/49","https://environment.ld.admin.ch/foen/nfi/Topic/49r","https://environment.ld.admin.ch/foen/nfi/Topic/50","https://environment.ld.admin.ch/foen/nfi/Topic/50r","https://environment.ld.admin.ch/foen/nfi/Topic/125","https://environment.ld.admin.ch/foen/nfi/Topic/214","https://environment.ld.admin.ch/foen/nfi/Topic/214r","https://environment.ld.admin.ch/foen/nfi/Topic/215","https://environment.ld.admin.ch/foen/nfi/Topic/215r","https://environment.ld.admin.ch/foen/nfi/Topic/417","https://environment.ld.admin.ch/foen/nfi/Topic/417r","https://environment.ld.admin.ch/foen/nfi/Topic/395","https://environment.ld.admin.ch/foen/nfi/Topic/395r","https://environment.ld.admin.ch/foen/nfi/Topic/210","https://environment.ld.admin.ch/foen/nfi/Topic/210r"],W=["https://environment.ld.admin.ch/foen/nfi/nfi_C-2207/cube/2024-1"];function w(){return new URLSearchParams(window.location.hash?.substring(1))}function Z(n,e){n.setMeasure(e.target.value)}function Y(n,e){let t=e.target.id.replace("-filter",""),i=e.target.value;n.setSelectedFilter(t,i)}function J(n,e){n.setClassification(e.target.value)}function Q(n,e){n.setRegion(e.target.value)}function ee(n,e){n.setRegionType(e.target.value)}function m(n){return n.trim().replaceAll(/\s/g,"-").replaceAll(/[()]/g,"")}function _(n){let e=n[0];if(g&&g.length>0){let t=n.find(i=>i.cube.value===g[0]);if(t)e=t;else{let i=n.find(s=>s.cube.value===g[1]);if(i)e=i;else{let s=n.find(r=>r.cube.value===g[2]);if(s)e=s;else{let r=n.find(o=>o.cube.value===g[3]);r?e=r:console.log("%cClassification not found in measure","color:black; background-color:orange;")}}}}return e}function te(n){let e={0:"0, 98, 104",1:"0, 98, 104",2:"152, 39, 41",3:"128, 128, 128",4:"153, 204, 204",5:"51, 102, 204",6:"153, 204, 153",7:"51, 153, 51",8:"255, 153, 153",9:"204, 51, 51",10:"255, 204, 102",11:"255, 102, 0",12:"204, 153, 204",13:"102, 51, 153",14:"0, 153, 102",15:"153, 102, 51",16:"204, 204, 204",17:"102, 102, 102",18:"51, 51, 51"},t=e[n];t===void 0&&(t=e[0],console.error("Not enough colors defined, please add more colors"));let i=t.split(", ");return ie(i[0],i[1],i[2])}function ie(n,e,t){return"#"+(1<<24|Number(n)<<16|Number(e)<<8|Number(t)).toString(16).slice(1)}var N=class{setValueForDropdown=(e,t)=>{let i=document.getElementById(e);i&&(i.value=t)};setMode=e=>{document.getElementById("chart-button").classList.toggle("active",e==="chart"),document.getElementById("map-button").classList.toggle("active",e==="map"),document.getElementById("grouped-region-field").classList.toggle("hidden",e==="map")};setGroupedClassification=e=>{let t=document.getElementById("grouped-classification");t.checked=e,document.getElementById("classification-filter").classList.toggle("hidden",e)};setGroupedRegion=e=>{let t=document.getElementById("grouped-region");t.checked=e,document.getElementById("region-field").classList.toggle("hidden",e),document.getElementById("region-type-field").classList.toggle("hidden",!e)};setRegionType=e=>{this.setValueForDropdown("region-type",e)};setRegion=e=>{this.setValueForDropdown("region",e)};setMeasure=e=>{this.setValueForDropdown("measures",e)};setClassification=e=>{this.setValueForDropdown("classification",e)};setOtherFilter=(e,t)=>{let i=`${m(e)}-filter`;this.setValueForDropdown(i,t)};populateSelect=(e,t,i,s,r,o,a,c,f=null)=>{let l=i;e==="topic-field"&&(l=l.filter(p=>K.includes(p.dimPath.value)===!1)),(e==="topic-field"||e==="classification-field")&&(l=l.sort((p,L)=>p.dimName.value>L.dimName.value)),e==="https://environment.ld.admin.ch/foen/nfi/classificationUnit-filter-field"&&(l=ne(l));let h=document.getElementById(e);h.className="field",h.innerHTML="";let u=document.createElement("select");u.id=t,u.className="ui dropdown"+(o?" search":""),u.addEventListener("change",a),l.length<=1&&u.classList.add("disabled");let S=document.createElement("label");S.htmlFor=t,S.innerHTML=c,h.append(S,u),l.forEach(p=>{u.append(this.createOptionElement(s(p),r(p),f))}),this.initDropdowns()};populateNestedSelect=(e,t,i,s,r,o,a,c,f)=>{let l=document.getElementById(e);l.className="field",l.innerHTML="";let h=document.createElement("select");h.id=t,h.className="ui dropdown"+(a?" search":""),h.addEventListener("change",c),i.length<=1&&h.classList.add("disabled");let u=document.createElement("label");u.htmlFor=t,u.innerHTML=f,l.append(u,h),i.forEach(S=>{let p=document.createElement("optgroup");p.label=s(S),h.append(p),S[1].forEach(L=>{p.append(this.createOptionElement(r(L),o(L)))})}),this.initDropdowns()};createOptionElement=(e,t,i)=>{let s=document.createElement("option");return s.value=e,s.innerHTML=t,e===i&&(s.selected=!0),s};initCheckboxes=()=>{$(".ui.checkbox").checkbox()};initDropdowns=()=>{$(".ui.dropdown").dropdown()}};function ne(n){let e=[],t="Total",i=["99","-1"],s=n.find(a=>I(a.value.value)===t);e.push(s);let o=n.filter(a=>{if(I(a.value.value)!==t&&i.includes(I(a.value.value))===!1)return!0}).sort((a,c)=>Number(I(a.value.value))>Number(I(c.value.value)));return e.push(...o),e}function I(n){let e=n.split("/");return e[e.length-1]}var U=class{lang;baseUrl;container;iframe;constructor(e,t,i){this.lang=e,this.baseUrl=t,this.container=i}createIframe(e){let t=document.createElement("iframe");t.id="chart",t.src=`${this.baseUrl}/${this.lang}/preview?flag__debug=true`,t.onload=()=>this.reloadIFrame(e),this.iframe=t,this.container.innerHTML="",this.container.append(t)}reloadIFrame(e){let t=this.iframe?.contentWindow;t&&t.postMessage(e(),R)}rerender(){this.iframe&&(this.iframe.src+="")}};var A=class{steps=[1,2,3,4];changeStep=e=>{this.steps.forEach(t=>{["step-indicator","step"].forEach(i=>document.getElementById(`${i}-${t}`).classList.toggle(i==="step-indicator"?"active":"in-active",i==="step-indicator"==(`${i}-${t}`==`${i}-${e}`)))}),this.updateStepperButton(e)};onNextStep=()=>{let e=this.getActiveStep();e<this.steps.length&&this.changeStep(e+1)};onLastStep=()=>{let e=this.getActiveStep();e>1&&this.changeStep(e-1)};getActiveStep(){let e=document.querySelector(".ui.vertical.steps .step.active");return parseInt(e.id.split("-").pop(),10)}updateStepperButton=e=>{let t=document.getElementById("last-button"),i=document.getElementById("next-button");t.classList.toggle("disabled",e===1),i.classList.toggle("disabled",Number(e)===this.steps.length)}};var P=class{urlParams;constructor(){this.urlParams=w()}getSortedFiltersFromUrl=()=>{let e=["mode","grouped-classification","grouped-region","regionType","region","measure","classification"];return Array.from(this.urlParams).sort(([t],[i])=>{let s=e.indexOf(t),r=e.indexOf(i),o=s>-1?s:e.length,a=r>-1?r:e.length;return o-a})};removeFilterInUrl=e=>{this.urlParams.delete(e);let t=`${window.location.origin}${window.location.pathname}#${decodeURIComponent(this.urlParams)}`;history.replaceState(null,"",t)};putFilterInUrl=(e,t)=>{y&&console.log("set filter:",e,t),this.urlParams.set(e,t);let i=`${window.location.origin}${window.location.pathname}#${decodeURIComponent(this.urlParams)}`;history.replaceState(null,"",i)}};var b=class{supportedLanguages=["de","fr","it","en"];config={filter:{de:"Schritte",fr:"\xC9tapes",it:"Passi",en:"Steps"},chart:{de:"Diagramm",fr:"Diagramme",it:"Diagramma",en:"Chart"},map:{de:"Karte",fr:"Carte",it:"Mappa",en:"Map"},topic:{de:"Thema",fr:"Sujet",it:"Tema",en:"Topic"},classification:{de:"Klassifizierungsmerkmal",fr:"Variable de classification",it:"Variabile di classificazione",en:"Classification variable"},region:{de:"Region",fr:"R\xE9gion",it:"Regione",en:"Region"},canton:{de:"Kanton",fr:"Canton",it:"Cantone",en:"Canton"},switzerland:{de:"Schweiz",fr:"Suisse",it:"Svizzera",en:"Switzerland"},regionType:{de:"Regionsart",fr:"Type de r\xE9gion",it:"Tipo di regione",en:"Region Type"},segmentation:{de:"Segmentierung",fr:"Segmentation",it:"Segmentazione",en:"Segmentation"},geography:{de:"Regionale Gliederung",fr:"D\xE9coupage r\xE9gional",it:"Suddivisione regionale",en:"Regional demarcation"},error:{de:"Etwas ist schief gelaufen. Bitte versuche es sp\xE4ter.",fr:"Une erreur est survenue. Veuillez r\xE9essayer plus tard.",it:"Si \xE8 verificato un errore. Per favore riprova pi\xF9 tardi.",en:"Something went wrong. Please try again later."},next:{de:"Weiter",fr:"Suivant",it:"Avanti",en:"Next"},last:{de:"Zur\xFCck",fr:"Dernier",it:"Ultimo",en:"Previous"},additionalFilters:{de:"Zus\xE4tzliche Filter",fr:"Filtres suppl\xE9mentaires",it:"Filtri aggiuntivi",en:"Additional filters"},visualizeLink:{de:"Auf visualize.admin.ch \xF6ffnen",fr:"Ouvrir sur visualize.admin.ch",it:"Aprire su visualize.admin.ch",en:"Open on visualize.admin.ch"},resetButton:{de:"zur\xFCcksetzen",fr:"r\xE9initialiser",it:"resettare",en:"reset"},backlink:{de:"Zur\xFCck",fr:"page pr\xE9c\xE9dente",it:"indietro",en:"back"},translatedPathname:{de:"/de/ergebnisabfrage/visualize-viewer",fr:"/fr/recherche-de-resultats/visualize-viewer",it:"/it/ricerca-di-risultati/visualize-viewer",en:"/en/result-query-system/visualize-viewer"},backlinkHref:{de:"/de/ergebnisabfrage/visualize",fr:"/fr/recherche-de-resultats/visualize",it:"/it/ricerca-di-risultati/visualize",en:"/en/result-query-system/visualize"},backlinkTitle:{de:"Zur\xFCck zur vorherigen Seite",fr:"Retour \xE0 la page pr\xE9c\xE9dente",it:"Indietro alla pagina precedente",en:"Back to the previous page"}};getLanguageFromUrl=(e,t)=>{let i;t==="nfi"&&(i=this.evaluateFromNFIUrl());let r=i??e.get("lang")??"de";return this.isValidLanguage(r)?r:"de"};evaluateFromNFIUrl=()=>window.location.pathname.split("/")[1];setLanguage=e=>{document.querySelectorAll(".lang").forEach(t=>{t.classList.toggle("active",e.toLocaleUpperCase()===t.innerHTML)})};isValidLanguage=e=>this.supportedLanguages.includes(e);updateLanguageDisplay=(e,t)=>{document.getElementById("filter-label").innerHTML=this.config.filter[t],document.getElementById("chart-button").innerHTML=`<i class="chart bar icon"></i>${this.config.chart[t]}`,document.getElementById("map-button").innerHTML=`<i class="map icon"></i>${this.config.map[t]}`,document.getElementById("segmentation-label-region").innerHTML=this.config.segmentation[t],document.getElementById("last-button-label").innerHTML=this.config.last[t],document.getElementById("next-button-label").innerHTML=this.config.next[t],document.getElementById("topic-step").innerHTML=this.config.topic[t],document.getElementById("classification-step").innerHTML=this.config.classification[t],document.getElementById("additional-filters-step").innerHTML=this.config.additionalFilters[t],document.getElementById("geography-step").innerHTML=this.config.geography[t],document.getElementById("step-title-1").innerHTML=this.config.topic[t],document.getElementById("step-title-2").innerHTML=this.config.classification[t],document.getElementById("step-title-3").innerHTML=this.config.additionalFilters[t],document.getElementById("step-title-4").innerHTML=this.config.geography[t],document.getElementById("visualize-link").innerHTML=this.config.visualizeLink[t],document.getElementById("reset-button").title=this.config.resetButton[t];let i=document.getElementById("backlink");i&&(i.innerHTML=this.config.backlink[t],i.title=this.config.backlinkTitle[t],i.href=window.location.origin+this.config.backlinkHref[t]),e==="nfi"?(this.translateURL(t),this.setLogoLink(t)):i&&i.remove()};translateURL=e=>{let t=`${window.location.origin}${this.config.translatedPathname[e]}#${window.location.hash}`;history.replaceState(null,"",t)};setLogoLink=e=>{let t=document.getElementById("logo-link");t&&(t.href="/"+e)}};var E={getPropertiesOptions:n=>`
    PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
    PREFIX sh: <http://www.w3.org/ns/shacl#>
    PREFIX schema: <http://schema.org/>
    PREFIX cube: <https://cube.link/>
    PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
    SELECT DISTINCT ?dimPath ?dimName ?value ?valueName
    FROM <https://lindas.admin.ch/foen/nfi>
    FROM <https://lindas.admin.ch/cube/dimension>
    WHERE {
        ?cube 
          a cube:Cube ;
          cube:observationConstraint ?shape .
        
        FILTER NOT EXISTS { ?cube schema:expires ?ex . }
        
        ?shape sh:property ?dim .
        ?dim 
          schema:name ?dimName ;
          sh:path ?dimPath ;
          rdf:type ?dimType ;
          sh:in/rdf:rest*/rdf:first ?value .
      
        ?value schema:name ?valueName .
    
        FILTER (LANGMATCHES(LANG(?valueName), "${n}"))
        FILTER (LANGMATCHES(LANG(?dimName), "${n}"))
        FILTER(?dimType = cube:KeyDimension)
        FILTER(?dimPath NOT IN (cube:observedBy))
        FILTER(?cube NOT IN (<https://environment.ld.admin.ch/foen/nfi/nfi_T-changes/cube/2024-1>))
    }
    ORDER BY ?dimPath
    LIMIT 10000
  `,getPropertiesForCubes:n=>`
    PREFIX meta: <https://cube.link/meta/>
    PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
    PREFIX sh: <http://www.w3.org/ns/shacl#>
    PREFIX schema: <http://schema.org/>
    PREFIX cube: <https://cube.link/>
    PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
    SELECT DISTINCT ?cube ?cubeName ?dimName ?dimPath ?dimType WHERE {
      GRAPH <https://lindas.admin.ch/foen/nfi> {
        ?cube a cube:Cube ;
          schema:name ?cubeName ;
          cube:observationConstraint ?shape .
        
        FILTER NOT EXISTS { ?cube schema:expires ?ex . }
        
        ?shape sh:property ?dim .
        ?dim schema:name ?dimName ;
          sh:path ?dimPath ;
          rdf:type ?dimType .
        
        FILTER(LANG(?dimName) = "${n}")
        FILTER(LANG(?cubeName) = "${n}")
        FILTER(?dimPath NOT IN (cube:observedBy, <https://environment.ld.admin.ch/foen/nfi/inventory>, <https://environment.ld.admin.ch/foen/nfi/unitOfReference>))
        FILTER(?cube NOT IN (<https://environment.ld.admin.ch/foen/nfi/nfi_T-changes/cube/2024-1>))
      }
    }
    ORDER BY ?dimName
    LIMIT 10000
  `,getRegionHierarchy:n=>`
    PREFIX meta: <https://cube.link/meta/>
    PREFIX dcterms: <http://purl.org/dc/terms/>
    PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
    PREFIX sh: <http://www.w3.org/ns/shacl#>
    PREFIX schema: <http://schema.org/>
    PREFIX cube: <https://cube.link/>
    PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
    
    SELECT DISTINCT ?value ?valueName ?type ?typeName
    WHERE {
      GRAPH <https://lindas.admin.ch/foen/nfi> {
        { SELECT DISTINCT ?value ?root WHERE {
          FILTER NOT EXISTS { ?cube schema:expires ?ex . }
          ?cube a cube:Cube ;
                cube:observationConstraint ?shape .
          ?shape sh:property ?dim .
          ?dim sh:path <https://environment.ld.admin.ch/foen/nfi/unitOfReference> ;
               meta:inHierarchy/meta:hierarchyRoot ?root ;
               sh:in/rdf:rest*/rdf:first ?value .
        }}
        OPTIONAL {
          ?value ^schema:about ?group .
          ?group <https://environment.ld.admin.ch/foen/nfi/subjectOf> ?root ;
                  schema:name ?groupName.
          FILTER (langMatches(lang(?groupName), "${n}"))
        }
     }
     ?value schema:name ?valueName .
     FILTER (langMatches(lang(?valueName), "${n}"))
     BIND (COALESCE(?groupName, ?valueName) AS ?typeName)
     BIND (COALESCE(?group, schema:Country) AS ?type)
    }
    ORDER BY ?type ?valueName
    LIMIT 1000
  `};async function T(n){return(await fetch(q,{method:"POST",headers:{Accept:"application/sparql-results+json","Content-Type":"application/x-www-form-urlencoded; charset=utf-8"},body:new URLSearchParams({query:n}).toString()})).json()}var se="https://environment.ld.admin.ch/foen/nfi/classificationUnit",k=class{lfiViewer;lang;properties;measure;classificationDimensions=[];cube;yAxis;constructor(e,t,i,s,r,o){this.lfiViewer=e,this.lang=t,this.properties={keys:[],measures:[]},this.uiAccessService=i,this.urlService=s,this.chartService=r,this.i18nService=o}setMeasure=e=>{let t=this.properties.measures.filter(i=>i.id===e);return t?(this.measure=_(t),this.cube=this.measure.cube.value,this.yAxis=this.measure.dimPath.value,this.urlService.putFilterInUrl("measure",this.yAxis),this.populateClassificationSelect(),this.chartService.rerender(),!0):(this.urlService.removeFilterInUrl("measure"),!1)};setClassification=e=>{let t=this.properties.keys.find(s=>s.id===e);if(!t)return this.urlService.removeFilterInUrl("classification"),!1;this.cube=t.cube.value;let i=this.getMeasureDimensions().find(s=>s.dimName.value===this.measure.dimName.value);return i?(this.yAxis=i.dimPath.value,this.urlService.putFilterInUrl("classification",this.cube),this.populateFilterSelects(),this.chartService.rerender(),!0):(this.urlService.removeFilterInUrl("classification"),this.setClassification(this.getCubesForMeasure()[0]),!1)};fetchProperties=async()=>{let t=(await T(E.getPropertiesForCubes(this.lang))).results.bindings,i=(r,o)=>r.dimPath.value.localeCompare(o.dimPath.value);this.properties.keys=t.filter(r=>r.dimType.value==="https://cube.link/KeyDimension").sort(i).map(r=>({...r,id:r.cube.value,options:[]})),this.properties.measures=t.filter(r=>r.dimType.value==="https://cube.link/MeasureDimension").sort(i).map(r=>({...r,id:r.dimPath.value}));let s=this.properties.measures.filter(r=>r.dimPath.value===V);this.measure=_(s),this.cube=this.measure.cube.value,this.yAxis=this.measure.dimPath.value};fetchPropertiesOptions=async()=>{let t=(await T(E.getPropertiesOptions(this.lang))).results.bindings;t.sort((i,s)=>i.valueName.value==="Total"?-1:s.valueName.value==="Total"?1:(""+i).localeCompare(s)),t.forEach(i=>{this.properties.keys.filter(s=>s.dimName.value===i.dimName.value).forEach(s=>s.options.push(i))})};getCubesForMeasure=()=>this.properties.measures.filter(e=>e.dimName.value===this.measure.dimName.value).map(e=>e.cube.value);getKeyDimensionsForCube=(e=void 0)=>{let t=this.properties.keys.filter(s=>s.cube.value===(e??this.cube)).sort((s,r)=>s.dimPath.value==="https://environment.ld.admin.ch/foen/nfi/classificationUnit"?-1:r.dimPath.value==="https://environment.ld.admin.ch/foen/nfi/classificationUnit"?1:s.dimPath.value.localeCompare(r.dimPath.value));this.classificationDimensions=[];let i=t.find(s=>s.cube.value===this.cube);return i&&i.options.forEach(s=>{this.classificationDimensions.includes(s.value.value)===!1&&this.classificationDimensions.push(s.value.value)}),t};getMeasureDimensions=()=>this.properties.measures.filter(e=>e.cube.value===this.cube);populateMeasureSelect=()=>{let e=[...new Map(this.properties.measures.map(t=>[t.dimName.value,t])).values()];this.uiAccessService.populateSelect("topic-field","measures",e,t=>t.id,t=>t.dimName.value,!0,t=>{Z(this.lfiViewer,t)},this.i18nService.config.topic[this.lang])};populateClassificationSelect=()=>{let e=this.getCubesForMeasure().flatMap(t=>this.getKeyDimensionsForCube(t).filter(i=>i.dimPath.value==="https://environment.ld.admin.ch/foen/nfi/classificationUnit"));e=e.filter(t=>W.includes(t.cube.value)===!1),this.uiAccessService.populateSelect("classification-field","classification",e,t=>t.id,t=>t.dimName.value,!0,t=>{J(this.lfiViewer,t)},this.i18nService.config.classification[this.lang],this.cube),this.populateFilterSelects()};populateFilterSelects=()=>{let e=document.getElementById("filters");e.innerHTML="";let t=document.getElementById("classification-filter");t.innerHTML="",this.getKeyDimensionsForCube().forEach(s=>{let r=m(s.dimPath.value),o=`${r}-filter`,a=`${o}-field`,c=document.createElement("div");c.className="field",c.id=a,r===se?t.append(c):e.append(c),this.uiAccessService.populateSelect(a,o,s.options,f=>f.value.value,f=>f.valueName.value,!1,f=>{Y(this.lfiViewer,f)},s.dimName.value)})}};var x=class{lfiViewer;lang;selectedRegion;selectedRegionType;regions;constructor(e,t,i,s,r,o){this.lfiViewer=e,this.lang=t,this.uiAccessService=i,this.urlService=s,this.chartService=r,this.i18nService=o}fetchRegions=async()=>{let t=(await T(E.getRegionHierarchy(this.lang))).results.bindings;this.regions=Object.groupBy(t,i=>i.type.value),Object.values(this.regions).forEach(i=>{i.name=i[0].typeName.value}),this.selectedRegion=this.regions["http://schema.org/Country"][0],this.selectedRegionType="https://environment.ld.admin.ch/foen/nfi/Cantons"};setRegion=e=>{let t=Object.values(this.regions).flat().find(i=>i.value.value===e);return t?(this.selectedRegion=t,this.urlService.putFilterInUrl("region",this.selectedRegion.value.value),this.chartService.rerender(),!0):(this.urlService.removeFilterInUrl("region"),!1)};setRegionType=e=>Object.keys(this.regions).includes(e)?(this.selectedRegionType=e,this.urlService.putFilterInUrl("regionType",this.selectedRegionType),this.chartService.rerender(),!0):(this.urlService.removeFilterInUrl("regionType"),!1);populateRegionSelect=()=>{let e=Object.entries(this.regions);this.uiAccessService.populateNestedSelect("region-field","region",e,([t,i])=>i.name,t=>t.value.value,t=>t.valueName.value,!0,t=>{Q(this.lfiViewer,t)},this.i18nService.config.region[this.lang]),this.uiAccessService.populateSelect("region-type-field","region-type",e,([t])=>t,([t,i])=>i.name,!1,t=>{ee(this.lfiViewer,t)},this.i18nService.config.regionType[this.lang])}};var B=class{mode="chart";groupedRegion;groupedClassification;get displayRegionTypes(){return this.groupedRegion||this.mode==="map"}get displayClassificationTypes(){return this.groupedClassification||this.mode!=="map"}constructor(e,t,i){this.uiAccessService=e,this.urlService=t,this.chartService=i}setMode=e=>{if(!["chart","map"].includes(e)){this.urlService.removeFilterInUrl("mode");return}this.urlService.putFilterInUrl("mode",e),this.mode=e,this.uiAccessService.setGroupedRegion(this.displayRegionTypes),this.uiAccessService.setMode(e),this.chartService.rerender()};setGroupedClassification=e=>{e!==!0&&e!==!1&&(e=!1),this.groupedClassification=e,this.urlService.putFilterInUrl("grouped-classification",e),this.uiAccessService.setGroupedClassification(e),this.chartService.rerender()};setGroupedRegion=e=>{e!==!0&&e!==!1&&(e=!1),this.groupedRegion=e,this.urlService.putFilterInUrl("grouped-region",e),this.uiAccessService.setGroupedRegion(this.displayRegionTypes),this.chartService.rerender()}};var O=class{selectedFilters={};constructor(e,t,i,s,r,o){this.uiAccessService=e,this.propertyService=t,this.regionService=i,this.filterUrlService=s,this.urlService=r,this.visualizationService=o}setSelectedFilter=(e,t)=>{if(e==="lang"||e==="mode")return!1;if(!this.propertyService.getKeyDimensionsForCube().map(r=>m(r.dimPath.value)).includes(e))return this.filterUrlService.removeFilterInUrl(e),delete this.selectedFilters[e],!1;let s=this.propertyService.getKeyDimensionsForCube().find(r=>m(r.dimPath.value)===e).options.find(r=>r.value.value==t);return s?(this.selectedFilters[e]=s,this.filterUrlService.putFilterInUrl(e,t),this.urlService.rerender(),!0):(this.filterUrlService.removeFilterInUrl(e),!1)};resetSelectedFilters=()=>{Object.keys(this.selectedFilters).forEach(this.filterUrlService.removeFilterInUrl),this.selectedFilters={},this.propertyService.getKeyDimensionsForCube().forEach(e=>{this.selectedFilters[m(e.dimPath.value)]=e.options[0]}),this.fillDefaultFiltersInUrl()};fillDefaultFiltersInUrl=()=>{let e=this.getPossibleFiltersFromUrl(),t=this.filterUrlService.getSortedFiltersFromUrl();e.filter(s=>!t.map(r=>r[0]).includes(s)).forEach(s=>{switch(y&&console.log("setting default for filter: ",s),s){case"mode":this.filterUrlService.putFilterInUrl(s,"chart");break;case"grouped-classification":this.filterUrlService.putFilterInUrl(s,!1);break;case"grouped-region":this.filterUrlService.putFilterInUrl(s,!1);break;case"regionType":this.filterUrlService.putFilterInUrl(s,this.regionService.selectedRegionType);break;case"region":this.filterUrlService.putFilterInUrl(s,this.regionService.selectedRegion.value.value);break;case"measure":this.filterUrlService.putFilterInUrl(s,this.propertyService.yAxis);break;case"classification":this.filterUrlService.putFilterInUrl(s,this.propertyService.cube);break;default:let r=this.propertyService.getKeyDimensionsForCube().find(o=>m(o.dimPath.value)===s)?.options[0].value.value;this.filterUrlService.putFilterInUrl(s,r);break}})};getSortedFiltersFromUrl=()=>{let e=["mode","grouped-region","regionType","region","measure","classification"];return Array.from(this.filterUrlService.urlParams).sort(([t],[i])=>{let s=e.indexOf(t),r=e.indexOf(i),o=s>-1?s:e.length,a=r>-1?r:e.length;return o-a})};getPossibleFiltersFromUrl=()=>{let e=["mode","grouped-classification","grouped-region","regionType","region","measure","classification"],t=this.propertyService.getKeyDimensionsForCube().map(i=>m(i.dimPath.value));return[...e,...t]};parseBoolean=e=>{if(e==="true")return!0;if(e==="false")return!1};applyFiltersFromUrl=()=>{this.fillDefaultFiltersInUrl(),this.getSortedFiltersFromUrl().map(([e,t])=>{switch(y&&console.log("apply filter: ",e,t),e){case"mode":this.visualizationService.setMode(t);break;case"grouped-classification":this.visualizationService.setGroupedClassification(this.parseBoolean(t));break;case"grouped-region":this.visualizationService.setGroupedRegion(this.parseBoolean(t));break;case"regionType":this.regionService.setRegionType(t)&&this.uiAccessService.setRegionType(t);break;case"region":this.regionService.setRegion(t)&&this.uiAccessService.setRegion(t);break;case"measure":this.propertyService.setMeasure(t)&&this.uiAccessService.setMeasure(t),this.resetSelectedFilters();break;case"classification":this.propertyService.setClassification(t)&&this.uiAccessService.setClassification(t),this.resetSelectedFilters();break;default:this.setSelectedFilter(e,t)&&this.uiAccessService.setOtherFilter(e,t);break}}),this.urlService.rerender()}};var v={chart:function(n,e){let t={};return Object.keys(e).map(i=>{if(i==="https://environment.ld.admin.ch/foen/nfi/classificationUnit")if(n.visualizationService.groupedClassification){let s={};n.propertyService.classificationDimensions.forEach((r,o)=>{r!=="https://environment.ld.admin.ch/foen/nfi/ClassificationUnit/Total"&&(s[r]=!0)}),t[e[i].dimPath.value]={type:"multi",values:s}}else t[e[i].dimPath.value]={type:"single",value:e[i].value.value};else t[e[i].dimPath.value]={type:"single",value:e[i].value.value}}),t["https://environment.ld.admin.ch/foen/nfi/unitOfReference"]=v.regionFilter(n,n.visualizationService.groupedRegion),{version:"4.0.0",state:"CONFIGURING_CHART",dataSource:{type:"sparql",url:`${C}`},layout:{type:"tab",meta:{title:{de:"",en:"",fr:"",it:""},description:{de:"",en:"",fr:"",it:""},label:{de:"",en:"",fr:"",it:""}}},chartConfigs:[{key:"zTuhSfYsiB7W",version:"3.2.0",meta:{title:{en:"",de:"",fr:"",it:""},description:{en:"",de:"",fr:"",it:""},label:{en:"",de:"",fr:"",it:""}},cubes:[{iri:n.propertyService.cube,publishIri:n.propertyService.cube,filters:t}],chartType:"column",interactiveFiltersConfig:{legend:{active:!1,componentIri:""},timeRange:{active:!1,componentIri:"https://environment.ld.admin.ch/foen/nfi/inventory",presets:{type:"range",from:"",to:""}},dataFilters:{active:!1,componentIris:[]},calculation:{active:!1,type:"identity"}},fields:{x:{componentIri:"https://environment.ld.admin.ch/foen/nfi/inventory",sorting:{sortingType:"byAuto",sortingOrder:"asc"}},y:{componentIri:n.propertyService.yAxis},...n.visualizationService.groupedRegion&&v.groupedRegion(),...n.visualizationService.groupedClassification&&v.groupedClassification(n)}}],activeChartKey:"zTuhSfYsiB7W"}},map:function(n,e){let t={};n.regionService.regions[n.regionService.selectedRegionType].forEach(s=>t[s.value.value]=!0);let i={};return i["https://environment.ld.admin.ch/foen/nfi/unitOfReference"]=v.regionFilter(n,!0),Object.keys(e).map(s=>{i[e[s].dimPath.value]={type:"single",value:e[s].value.value}}),{version:"3.4.0",state:"CONFIGURING_CHART",dataSource:{type:"sparql",url:`${C}`},layout:{type:"tab",meta:{title:{de:"",en:"",fr:"",it:""},description:{de:"",en:"",fr:"",it:""}}},chartConfigs:[{key:"jEASF-9qEqaC",version:"3.3.0",meta:{title:{en:"",de:"",fr:"",it:""},description:{en:"",de:"",fr:"",it:""}},cubes:[{iri:n.propertyService.cube,publishIri:n.propertyService.cube,filters:i}],activeField:"animation",chartType:"map",interactiveFiltersConfig:{legend:{active:!1,componentIri:""},timeRange:{active:!1,componentIri:"https://environment.ld.admin.ch/foen/nfi/inventory",presets:{type:"range",from:"",to:""}},dataFilters:{active:!1,componentIris:[]},calculation:{active:!1,type:"identity"}},baseLayer:{show:!0,locked:!1},fields:{areaLayer:{componentIri:"https://environment.ld.admin.ch/foen/nfi/unitOfReference",color:{type:"numerical",componentIri:n.propertyService.yAxis,palette:"oranges",scaleType:"continuous",interpolationType:"linear",opacity:100}},animation:{componentIri:"https://environment.ld.admin.ch/foen/nfi/inventory",showPlayButton:!0,duration:10,type:"stepped",dynamicScales:!1}}}],activeChartKey:"jEASF-9qEqaC",dashboardFilters:{filters:[]}}},groupedRegion:function(){return{segment:{componentIri:"https://environment.ld.admin.ch/foen/nfi/unitOfReference",palette:"category10",sorting:{sortingType:"byAuto",sortingOrder:"asc"},colorMapping:{"https://ld.admin.ch/canton/1":"#1f77b4","https://ld.admin.ch/canton/10":"#ff7f0e","https://ld.admin.ch/canton/11":"#2ca02c","https://ld.admin.ch/canton/14":"#d62728","https://ld.admin.ch/canton/15":"#9467bd","https://ld.admin.ch/canton/16":"#8c564b","https://ld.admin.ch/canton/17":"#e377c2","https://ld.admin.ch/canton/18":"#7f7f7f","https://ld.admin.ch/canton/19":"#bcbd22","https://ld.admin.ch/canton/2":"#17becf","https://ld.admin.ch/canton/20":"#1f77b4","https://ld.admin.ch/canton/21":"#ff7f0e","https://ld.admin.ch/canton/22":"#2ca02c","https://ld.admin.ch/canton/23":"#d62728","https://ld.admin.ch/canton/24":"#9467bd","https://ld.admin.ch/canton/25":"#8c564b","https://ld.admin.ch/canton/26":"#e377c2","https://ld.admin.ch/canton/3":"#7f7f7f","https://ld.admin.ch/canton/4":"#bcbd22","https://ld.admin.ch/canton/5":"#17becf","https://ld.admin.ch/canton/6":"#1f77b4","https://ld.admin.ch/canton/7":"#ff7f0e","https://ld.admin.ch/canton/8":"#2ca02c","https://ld.admin.ch/canton/9":"#d62728","https://ld.admin.ch/country/CHE":"#9467bd","https://ld.admin.ch/dimension/bgdi/biota/cantonregions/13":"#8c564b","https://ld.admin.ch/dimension/bgdi/biota/economicregions/1":"#e377c2","https://ld.admin.ch/dimension/bgdi/biota/economicregions/10":"#7f7f7f","https://ld.admin.ch/dimension/bgdi/biota/economicregions/11":"#bcbd22","https://ld.admin.ch/dimension/bgdi/biota/economicregions/12":"#17becf","https://ld.admin.ch/dimension/bgdi/biota/economicregions/13":"#1f77b4","https://ld.admin.ch/dimension/bgdi/biota/economicregions/14":"#ff7f0e","https://ld.admin.ch/dimension/bgdi/biota/economicregions/2":"#2ca02c","https://ld.admin.ch/dimension/bgdi/biota/economicregions/3":"#d62728","https://ld.admin.ch/dimension/bgdi/biota/economicregions/4":"#9467bd","https://ld.admin.ch/dimension/bgdi/biota/economicregions/5":"#8c564b","https://ld.admin.ch/dimension/bgdi/biota/economicregions/6":"#e377c2","https://ld.admin.ch/dimension/bgdi/biota/economicregions/7":"#7f7f7f","https://ld.admin.ch/dimension/bgdi/biota/economicregions/8":"#bcbd22","https://ld.admin.ch/dimension/bgdi/biota/economicregions/9":"#17becf","https://ld.admin.ch/dimension/bgdi/biota/productionregions/1":"#1f77b4","https://ld.admin.ch/dimension/bgdi/biota/productionregions/2":"#ff7f0e","https://ld.admin.ch/dimension/bgdi/biota/productionregions/3":"#2ca02c","https://ld.admin.ch/dimension/bgdi/biota/productionregions/4":"#d62728","https://ld.admin.ch/dimension/bgdi/biota/productionregions/5":"#9467bd","https://ld.admin.ch/dimension/bgdi/biota/protectionforestregions/1":"#8c564b","https://ld.admin.ch/dimension/bgdi/biota/protectionforestregions/2":"#e377c2","https://ld.admin.ch/dimension/bgdi/biota/protectionforestregions/3":"#7f7f7f","https://ld.admin.ch/dimension/bgdi/biota/protectionforestregions/4":"#bcbd22","https://ld.admin.ch/dimension/bgdi/biota/protectionforestregions/5":"#17becf","https://ld.admin.ch/dimension/bgdi/biota/protectionforestregions/6":"#1f77b4"},type:"grouped",useAbbreviations:!0}}},groupedClassification:function(n){let e={};n.propertyService.classificationDimensions.forEach((r,o)=>{e[r]=te(o)});let i=n.propertyService.cube.split("/");return i.pop(),{segment:{componentId:i.join("/")+"(VISUALIZE.ADMIN_COMPONENT_ID_SEPARATOR)https://environment.ld.admin.ch/foen/nfi/classificationUnit",palette:"category10",sorting:{sortingType:"byAuto",sortingOrder:"asc"},colorMapping:e,type:"stacked"}}},regionFilter:function(n,e){if(e){let t={};return n.regionService.regions[n.regionService.selectedRegionType].forEach(i=>t[i.value.value]=!0),{type:"multi",values:t}}else return{type:"single",value:n.regionService.selectedRegion.value.value}}};var M=class{#t="visualize-link";#e;constructor(){this.#e=document.getElementById(this.#t)}setCube(e){this.#e.href=j+e}};var D=class{constructor(e,t,i){this.lang=e,this.uiAccessService=new N,this.chartService=new U(this.lang,t,i),this.stepperService=new A,this.urlService=new P,this.i18nService=new b,this.propertyService=new k(this,this.lang,this.uiAccessService,this.urlService,this.chartService,this.i18nService),this.regionService=new x(this,this.lang,this.uiAccessService,this.urlService,this.chartService,this.i18nService),this.visualizationService=new B(this.uiAccessService,this.urlService,this.chartService),this.filterService=new O(this.uiAccessService,this.propertyService,this.regionService,this.urlService,this.chartService,this.visualizationService),this.linkService=new M}initialize=async()=>{this.urlService.putFilterInUrl("lang",this.lang),await Promise.all([this.propertyService.fetchProperties(),this.regionService.fetchRegions()]),await this.propertyService.fetchPropertiesOptions(),this.propertyService.populateMeasureSelect(),this.propertyService.populateClassificationSelect(),this.regionService.populateRegionSelect(),this.filterService.resetSelectedFilters(),this.filterService.applyFiltersFromUrl(),this.chartService.createIframe(()=>v[this.visualizationService.mode](this,this.filterService.selectedFilters)),this.chartService.rerender(),this.uiAccessService.initDropdowns(),this.uiAccessService.initCheckboxes()};setStep=e=>{this.stepperService.changeStep(Number(e))};setNextStep=()=>{this.stepperService.onNextStep()};setLastStep=()=>{this.stepperService.onLastStep()};setMeasure=e=>{this.propertyService.setMeasure(e)};setClassification=e=>{this.propertyService.setClassification(e),this.linkService.setCube(e)};setRegion=e=>{this.regionService.setRegion(e)};setRegionType=e=>{this.regionService.setRegionType(e)};setMode=e=>{this.visualizationService.setMode(e)};setGroupedClassification=e=>{this.visualizationService.setGroupedClassification(e)};setGroupedRegion=e=>{this.visualizationService.setGroupedRegion(e)};setSelectedFilter=(e,t)=>{this.filterService.setSelectedFilter(e,t)};printChartState=()=>{console.log(v[this.visualizationService.mode](this,this.filterService.selectedFilters))}};var d,z,F=new b;oe();async function re(n,e=null){try{if(n===null){let i=w();n=F.getLanguageFromUrl(i,e)}e&&(z=e),H();let t=document.getElementById("main-content");t?(d=new D(n,R,t,z),F.setLanguage(n),F.updateLanguageDisplay(z,n),await d.initialize(),G()):console.error("Initialization failed: Target element not found")}catch(t){console.error("Initialization failed: ",t),X(F,n)}}function oe(){let n=document.querySelectorAll(".step");for(let c of n)c.addEventListener("click",ae);document.getElementById("next-button").addEventListener("click",ce),document.getElementById("last-button").addEventListener("click",le),document.getElementById("grouped-classification").addEventListener("change",de),document.getElementById("grouped-region").addEventListener("change",he);let r=document.querySelectorAll(".visualization-buttons .button");for(let c of r)c.addEventListener("click",ue);let o=document.querySelectorAll(".header .menu .lang.item");for(let c of o)c.addEventListener("click",pe);document.getElementById("reset-button").addEventListener("click",me)}function ae(n){d.setStep(Number(n.target.dataset.step))}function ce(){d.setNextStep()}function le(){d.setLastStep()}function de(n){fe(n.target.checked),n.target.checked&&(d.setGroupedRegion(!1),d.setMode("chart")),d.setGroupedClassification(n.target.checked)}function he(n){d.setGroupedClassification(!1),d.setGroupedRegion(n.target.checked)}function ue(n){n.target.dataset.mode==="map"&&d.setGroupedClassification(!1),d.setMode(n.target.dataset.mode)}async function pe(n){if(n){let e=n.target.dataset.lang;F.isValidLanguage(e)&&await re(e,z)}}function me(){window.location=window.location.pathname}function fe(n){document.getElementById("classification-filter").classList.toggle("hidden",n)}export{re as initialize};
//# sourceMappingURL=visualize-viewer.min.js.map
